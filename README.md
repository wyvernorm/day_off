# üìÖ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏∞ & ‡∏ß‡∏±‡∏ô‡∏•‡∏≤

‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô ‡∏ß‡∏±‡∏ô‡∏•‡∏≤ ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏∞ ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ó‡∏µ‡∏°‡∏Ç‡∏ô‡∏≤‡∏î‡πÄ‡∏•‡πá‡∏Å-‡∏Å‡∏•‡∏≤‡∏á  
‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏î‡πâ‡∏ß‡∏¢ **Cloudflare Worker + D1 Database**

## ‚ú® Features

| Feature | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î |
|---------|-----------|
| üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô | ‡∏°‡∏∏‡∏°‡∏°‡∏≠‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡πÅ‡∏ö‡∏ö Google Calendar ‡πÄ‡∏´‡πá‡∏ô‡∏Å‡∏∞‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏î‡∏µ‡∏¢‡∏ß |
| üìã ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏∞ | Roster view ‡∏î‡∏π‡∏Å‡∏∞‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏ï‡∏≤‡∏£‡∏≤‡∏á |
| üìä ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ | ‡∏î‡∏π‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ/‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ‡∏û‡∏£‡πâ‡∏≠‡∏° progress bar |
| üîÑ ‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏∞ | ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏∞‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏£‡∏∞‡∏ö‡∏ö‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ |
| üìÖ ‡∏™‡∏•‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î | ‡∏™‡∏•‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á 2 ‡∏Ñ‡∏ô |
| üìù ‡∏•‡∏≤‡∏á‡∏≤‡∏ô | ‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢/‡∏Å‡∏¥‡∏à/‡∏û‡∏±‡∏Å‡∏£‡πâ‡∏≠‡∏ô ‡∏û‡∏£‡πâ‡∏≠‡∏° quota tracking |
| üîî ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ | ‡∏´‡∏ô‡πâ‡∏≤‡∏£‡∏≠‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ ‚Äî approve/reject ‡∏ß‡∏±‡∏ô‡∏•‡∏≤‡πÅ‡∏•‡∏∞‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏∞ |
| üìú ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥ | ‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏° filter |
| ‚ö° KPI | ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î ‡∏û‡∏£‡πâ‡∏≠‡∏°‡∏™‡∏£‡∏∏‡∏õ‡πÅ‡∏ï‡πâ‡∏°/‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà |
| üî¥ ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î | ‡∏£‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ô‡∏±‡∏Å‡∏Ç‡∏±‡∏ï‡∏§‡∏Å‡∏©‡πå |
| üë§ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô | ‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç/‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô |
| üîê Google OAuth | ‡∏•‡πá‡∏≠‡∏Å‡∏≠‡∏¥‡∏ô‡∏î‡πâ‡∏ß‡∏¢ Google Account |
| üì± Telegram | ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏ú‡πà‡∏≤‡∏ô Telegram Bot |

## üöÄ Setup

### 1. Clone & Install

```bash
git clone <your-repo>
cd shift-manager
npm install
```

### 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á D1 Database

```bash
wrangler d1 create shift-manager-db
# ‡∏à‡∏∞‡πÑ‡∏î‡πâ database_id ‡∏Å‡∏•‡∏±‡∏ö‡∏°‡∏≤ ‚Äî ‡πÄ‡∏≠‡∏≤‡πÑ‡∏õ‡πÉ‡∏™‡πà‡πÉ‡∏ô wrangler.toml
```

### 3. ‡πÅ‡∏Å‡πâ `wrangler.toml`

```toml
[[d1_databases]]
binding = "DB"
database_name = "shift-manager-db"
database_id = "‡πÉ‡∏™‡πà_DATABASE_ID_‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏à‡∏≤‡∏Å‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡∏≠‡∏ô_2"
```

### 4. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Secrets

```bash
npx wrangler secret put GOOGLE_CLIENT_ID
npx wrangler secret put GOOGLE_CLIENT_SECRET
npx wrangler secret put SESSION_SECRET
npx wrangler secret put TG_BOT_TOKEN
npx wrangler secret put TG_CHAT_ID
```

### 5. Init Database Schema

```bash
npm run db:init:local   # ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö local dev
npm run db:init          # ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö production
```

### 6. Run / Deploy

```bash
npm run dev      # Local development
npm run deploy   # Deploy to Cloudflare
```

## üìÅ Project Structure

```
shift-manager/
‚îú‚îÄ‚îÄ wrangler.toml     # Cloudflare Worker config
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ index.js          # Main Worker entry point + OAuth + rate limiting
‚îú‚îÄ‚îÄ api.js            # API routes handler
‚îî‚îÄ‚îÄ frontend.js       # Frontend HTML/CSS/JS (served from Worker)
```

## üîå API Endpoints

### Auth
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/auth/login` | ‡πÄ‡∏£‡∏¥‡πà‡∏° Google OAuth flow |
| GET | `/auth/callback` | Google OAuth callback |
| GET | `/auth/logout` | ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö |

### Me (‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á)
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/me` | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á |
| PUT | `/api/me` | ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç nickname, avatar, phone, line_id |

### Employees
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/employees` | ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î |
| POST | `/api/employees` | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà (admin/owner) |
| PUT | `/api/employees/:id` | ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô |
| DELETE | `/api/employees/:id` | ‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô (soft delete, admin/owner) |

### Shifts
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/shifts` | ‡∏ï‡∏±‡πâ‡∏á/‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏∞ (upsert) |

### Leaves
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/leaves?month=&status=&year=&limit=&offset=` | ‡∏î‡∏π‡∏ß‡∏±‡∏ô‡∏•‡∏≤ (paginated) |
| POST | `/api/leaves` | ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤ (‡∏ß‡∏±‡∏ô‡πÄ‡∏î‡∏µ‡∏¢‡∏ß) |
| POST | `/api/leaves/range` | ‡∏•‡∏á‡∏ß‡∏±‡∏ô‡∏•‡∏≤ (‡∏´‡∏•‡∏≤‡∏¢‡∏ß‡∏±‡∏ô) |
| PUT | `/api/leaves/:id/approve` | ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏ß‡∏±‡∏ô‡∏•‡∏≤ |
| PUT | `/api/leaves/:id/reject` | ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò‡∏ß‡∏±‡∏ô‡∏•‡∏≤ |
| DELETE | `/api/leaves/:id` | ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏ß‡∏±‡∏ô‡∏•‡∏≤ (‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡∏£‡∏∑‡∏≠ admin) |

### Swap Requests
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/swaps?status=pending` | ‡∏î‡∏π‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏∞ |
| POST | `/api/swaps` | ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏•‡∏±‡∏ö‡∏Å‡∏∞ |
| POST | `/api/swaps/dayoff` | ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡∏™‡∏•‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î |
| PUT | `/api/swaps/:id/approve` | ‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ |
| PUT | `/api/swaps/:id/reject` | ‡∏õ‡∏è‡∏¥‡πÄ‡∏™‡∏ò |

### Holidays
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/holidays?year=2026` | ‡∏î‡∏π‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î |
| POST | `/api/holidays` | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î (admin/owner) |
| DELETE | `/api/holidays/:id` | ‡∏•‡∏ö‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î (admin/owner) |

### KPI Error Tracking
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/kpi/categories` | ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î |
| GET | `/api/kpi/details?category_id=` | ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î |
| POST | `/api/kpi/details` | ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î (admin/owner) |
| PUT | `/api/kpi/details/:id` | ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç (admin/owner) |
| DELETE | `/api/kpi/details/:id` | ‡∏•‡∏ö (admin/owner) |
| GET | `/api/kpi/errors?year=&month=&limit=&offset=` | ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î (paginated) |
| POST | `/api/kpi/errors` | ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î (admin/owner) |
| DELETE | `/api/kpi/errors/:id` | ‡∏•‡∏ö (admin/owner) |
| GET | `/api/kpi/summary?year=&month=` | ‡∏™‡∏£‡∏∏‡∏õ KPI |

### Overview & History
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/overview?month=YYYY-MM` | ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô |
| GET | `/api/history?year=YYYY` | ‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥ |

### Settings
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/api/settings` | ‡∏î‡∏π‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ |
| PUT | `/api/settings` | ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ (admin/owner) |

## ‚öôÔ∏è Settings Keys

| Key | Description | ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á |
|-----|-------------|---------|
| `company_name` | ‡∏ä‡∏∑‡πà‡∏≠‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó | `My Company` |
| `company_holidays_per_year` | ‡∏ß‡∏±‡∏ô‡∏´‡∏¢‡∏∏‡∏î‡∏ö‡∏£‡∏¥‡∏©‡∏±‡∏ó/‡∏õ‡∏µ | `20` |
| `sick_approvers` | ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏°‡∏µ‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏≠‡∏ô‡∏∏‡∏°‡∏±‡∏ï‡∏¥‡∏•‡∏≤‡∏õ‡πà‡∏ß‡∏¢ (‡∏Ñ‡∏±‡πà‡∏ô ,) | `admin@x.com,hr@x.com` |
| `blackout_dates` | ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (‡∏Ñ‡∏±‡πà‡∏ô ,) | `2026-01-01,2026-01-02` |
| `kpi_admins` | ‡∏≠‡∏µ‡πÄ‡∏°‡∏•‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏• KPI (‡∏Ñ‡∏±‡πà‡∏ô ,) | `admin@x.com` |

## üìÑ License

MIT
